<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>My Profile · Fake News Identifier</title>

  <!-- Materialize CSS + Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
  <link rel="stylesheet" href="css/styles.css"/>

  <style>
    /* Match home page card style */
    .glass-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .page-title {
      font-size: 2rem;
      font-weight: 700;
      margin: 1rem 0 1.5rem;
      background: linear-gradient(90deg, #c084fc, #7c3aed);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    label { color: #bbb !important; }
    input { color: white; }
    .btn-save {
      border-radius: 20px;
      font-weight: 600;
      text-transform: uppercase;
      background: linear-gradient(90deg, #7c3aed, #9333ea);
    }
  </style>
</head>
<body class="theme-dark">

   <!-- NAV -->
  <nav class="nav-glass">
    <div class="nav-wrapper container">
      <a href="#home" class="brand-logo truncate">Fake News Identifier</a>
      <a href="#" data-target="mobile-nav" class="sidenav-trigger"><i class="material-icons">menu</i></a>

      <ul class="right hide-on-med-and-down">
        <li><a href="#how">How it works</a></li>
        <li><a href="#features">Features</a></li>
        <li><a href="#tech">Tech</a></li>
        <li><a href="#team">Team</a></li>

        <!-- Logged OUT -->
        <li class="auth-logged-out">
          <a class="modal-trigger" href="/register.html" data-target="modal-register">
            <i class="material-icons left">person_add</i>Create account
          </a>
        </li>
        <li class="auth-logged-out">
          <a class="modal-trigger" href="/login.html" data-target="modal-login">
            <i class="material-icons left">login</i>Log in
          </a>
        </li>

        <!-- Logged IN -->
        <li class="auth-logged-in" style="display:none">
          <a href="/profile.html"><i class="material-icons left">account_circle</i>Profile</a>
        </li>
        <li class="auth-logged-in" style="display:none">
          <a id="nav-logout" href="#!"><i class="material-icons left">logout</i>Logout</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Mobile sidenav -->
  <ul id="mobile-nav" class="sidenav">
    <li><a href="#how"><i class="material-icons">help_outline</i>How it works</a></li>
    <li><a href="#features"><i class="material-icons">star_border</i>Features</a></li>
    <li><a href="#tech"><i class="material-icons">build</i>Tech</a></li>
    <li><a href="#team"><i class="material-icons">group</i>Team</a></li>

    <!-- Logged OUT -->
    <li class="auth-logged-out">
      <a class="modal-trigger" href="/regisiter.html" data-target="modal-register">
        <i class="material-icons">person_add</i>Create account
      </a>
    </li>
    <li class="auth-logged-out">
      <a class="modal-trigger" href="/regisiter.html" data-target="modal-login">
        <i class="material-icons">login</i>Log in
      </a>
    </li>

    <!-- Logged IN -->
    <li class="auth-logged-in" style="display:none">
      <a href="/profile.html"><i class="material-icons">account_circle</i>Profile</a>
    </li>
    <li class="auth-logged-in" style="display:none">
      <a id="m-nav-logout" href="#!"><i class="material-icons">logout</i>Logout</a>
    </li>
  </ul>

  <main class="container" style="margin-top: 2rem;">
    <h3 class="page-title">My Profile</h3>

    <!-- Account Info -->
    <div class="glass-card">
      <h6 class="section-label">Account</h6>
      <div class="row" style="margin-bottom: 0.75rem;">
        <div class="col s12 m6"><p><strong>Name:</strong> <span id="nameText">—</span></p></div>
        <div class="col s12 m6"><p><strong>Email:</strong> <span id="emailText">—</span></p></div>
      </div>
      <p><strong>User ID:</strong> <span id="idText">—</span></p>
    </div>

    <!-- Change Display Name -->
    <div class="glass-card">
      <h6 class="section-label">Change display name</h6>
      <div class="row" style="margin-top: 0.5rem;">
        <div class="input-field col s12 m8">
          <input id="newName" type="text"/>
          <label for="newName">New name</label>
        </div>
        <div class="input-field col s12 m4">
          <button id="saveNameBtn" class="btn btn-save waves-effect waves-light" style="width:100%">
            <i class="material-icons left">save</i>Save
          </button>
        </div>
      </div>
    </div>

    <!-- Not logged in notice -->
    <div id="notAuth" class="card red darken-2" style="display:none">
      <div class="card-content white-text">
        <span class="card-title"><i class="material-icons left">error_outline</i>Not logged in</span>
        <p>Go back to the <a href="/" class="yellow-text text-lighten-3">home page</a> and log in.</p>
      </div>
    </div>
  </main>

  <footer class="page-footer footer-compact">
    <div class="container">© 2025 Group 11 · Fake News Identifier</div>
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js" defer></script>
  <script>
    const $ = (sel) => document.querySelector(sel);
    const toast = (msg) => window.M && M.toast({ html: msg });

    async function fetchJSON(url, opts) {
      const r = await fetch(url, opts);
      const data = await r.json().catch(() => ({}));
      return { ok: r.ok, data };
    }
    async function putJSON(url, body) {
      const r = await fetch(url, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify(body)
      });
      const data = await r.json().catch(() => ({}));
      return { ok: r.ok, data };
    }

    async function loadProfile() {
      let res = await fetchJSON("/api/profile", { credentials: "include" });
      if (!res.ok) res = await fetchJSON("/auth/me", { credentials: "include" });

      if (!res.ok) {
        $("#notAuth").style.display = "";
        return;
      }
      const user = res.data.user || res.data;
      $("#nameText").textContent  = user.name || "—";
      $("#emailText").textContent = user.email || "—";
      $("#idText").textContent    = user.id || user._id || "—";
      $("#newName").value = user.name || "";
      if (window.M && M.updateTextFields) M.updateTextFields();
    }

    async function saveName() {
      const name = ($("#newName").value || "").trim();
      if (!name) return toast("Enter a name");
      const res = await putJSON("/api/profile", { name });
      if (!res.ok) return toast(res.data?.error || "Failed to update name");
      const user = res.data.user || {};
      $("#nameText").textContent = user.name || name;
      toast("Name updated");
    }

    async function doLogout() {
      try { await fetch("/auth/logout", { method: "POST", credentials: "include" }); } catch {}
      location.href = "/";
    }

    document.addEventListener("DOMContentLoaded", () => {
      if (window.M) M.AutoInit();
      loadProfile();
      $("#saveNameBtn")?.addEventListener("click", saveName);
      $("#logoutBtn")?.addEventListener("click", doLogout);
    });
  </script>
</body>
</html>
