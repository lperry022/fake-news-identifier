<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <base href="/frontend/"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Register • Fake News Identifier</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css"/>

  <!-- Load site libs once -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js" defer></script>
  <script src="js/app.js" defer></script>
</head>
<body class="theme-dark">
  <div id="navbar-container"></div>

  <main class="container auth-wrap">
    <h1 class="auth-hero center-align" style="margin-top:28px;">Create account</h1>
    <p class="grey-text text-lighten-1 center-align" style="margin-bottom:24px">
      Register to save your checks and access your dashboard.
    </p>

    <div class="card auth-card" style="max-width:500px;margin:0 auto;">
      <div class="card-content white-text">
        <form id="registerForm" novalidate>
          <div class="input-field">
            <input id="reg-name" type="text" required placeholder="Your name">
            <label for="reg-name">Name</label>
          </div>

          <div class="input-field">
            <input id="reg-email" type="email" autocomplete="email" required placeholder="you@example.com">
            <label for="reg-email">Email</label>
          </div>

          <div class="input-field">
            <input id="reg-password" type="password" autocomplete="new-password" required placeholder="********">
            <label for="reg-password">Password</label>
          </div>

          <p>
            <label>
              <input type="checkbox" id="human-check" />
              <span>I’m not a bot</span>
            </label>
          </p>

          <div class="section" style="margin-top:12px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
            <button id="btn-register" class="btn btn-cta waves-effect waves-light" type="submit" disabled>
              <i class="material-icons left">person_add</i>Create account
            </button>
            <a href="/frontend/login.html" class="btn-flat auth-hint">Already have an account? Log in</a>
          </div>
        </form>
      </div>
    </div>
  </main>

  <footer class="page-footer footer-compact">
    <div class="container">© 2025 Group 11 · Fake News Identifier</div>
  </footer>

  <script src="js/navbar.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('registerForm');
    const chk  = document.getElementById('human-check');
    const btn  = document.getElementById('btn-register');

    if (chk && btn) chk.addEventListener('change', () => { btn.disabled = !chk.checked; });

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('reg-name')?.value?.trim();
      const email = document.getElementById('reg-email')?.value?.trim();
      const password = document.getElementById('reg-password')?.value || '';

      if (!name || !email || !password) {
        M.toast({ html: 'Name, email, and password are required', classes: 'red darken-2' });
        return;
      }

      try {
        const res = await fetch('/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ name, email, password })
        });
        const data = await res.json().catch(() => ({}));
        if (!res.ok) throw new Error(data?.error || res.statusText);

        Auth.setToken('session');
        localStorage.setItem('userName', data?.user?.name || name);
        M.toast({ html: 'Account created!', classes: 'green darken-2' });
        Auth.completeLoginAndRedirect('/frontend/dashboard.html');
      } catch (err) {
        M.toast({ html: err.message || 'Registration failed', classes: 'red darken-2' });
      }
    });
  });
  </script>
</body>
</html>
