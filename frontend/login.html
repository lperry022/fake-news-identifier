<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Log in • Fake News Identifier</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css"/>
</head>
<body class="theme-dark">

<!-- NAVBAR -->
<nav class="nav-glass">
  <div class="nav-wrapper container">
    <a href="/frontend/index.html#home" class="brand-logo truncate">Fake News Identifier</a>
    <a href="#" data-target="mobile-nav" class="sidenav-trigger"><i class="material-icons">menu</i></a>
    <ul class="right hide-on-med-and-down">
      <li><a href="/frontend/index.html#how">How it works</a></li>
      <li><a href="/frontend/index.html#features">Features</a></li>
      <li><a href="/frontend/index.html#tech">Tech</a></li>
      <li><a href="/frontend/index.html#team">Team</a></li>
      <li><a href="/frontend/register.html"><i class="material-icons left">person_add</i>Create account</a></li>
    </ul>
  </div>
</nav>

<!-- SIDENAV -->
<ul id="mobile-nav" class="sidenav">
  <li><a href="/frontend/index.html#how"><i class="material-icons">help_outline</i>How it works</a></li>
  <li><a href="/frontend/index.html#features"><i class="material-icons">star_border</i>Features</a></li>
  <li><a href="/frontend/index.html#tech"><i class="material-icons">build</i>Tech</a></li>
  <li><a href="/frontend/index.html#team"><i class="material-icons">group</i>Team</a></li>
  <li><a href="/frontend/register.html"><i class="material-icons">person_add</i>Create account</a></li>
</ul>

<main class="container section">
  <h3 class="hero-title" style="text-align:left;margin-top:12px">Log in</h3>

  <div class="card result-card">
    <div class="card-content white-text">
      <form id="loginForm" autocomplete="on" novalidate>
        <div class="input-field">
          <input id="login-email" name="email" type="email" required autocomplete="email">
          <label for="login-email">Email</label>
        </div>

        <div class="input-field" style="position:relative">
          <input id="login-password" name="password" type="password" required autocomplete="current-password" minlength="8">
          <label for="login-password">Password</label>
          <button type="button" id="togglePwd" class="btn-flat" style="position:absolute;right:0.25rem;top:0.25rem">
            <i class="material-icons">visibility</i>
          </button>
        </div>

        <p>
          <label>
            <input type="checkbox" id="rememberMe"/>
            <span>Remember me on this device</span>
          </label>
        </p>

        <div class="section" style="margin-top:8px">
          <button class="btn btn-cta" type="submit">
            <i class="material-icons left">login</i>Log in
          </button>
          <a href="/frontend/register.html" class="btn-flat how-link">Need an account? Create one</a>
        </div>
      </form>
      <p class="grey-text text-lighten-1" style="margin-top:8px;">Frontend-only login: stores a demo session in your browser.</p>
    </div>
  </div>
</main>

<footer class="page-footer footer-compact">
  <div class="container">© 2025 Group 11 · Fake News Identifier</div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
  // --- Utilities (frontend-only "auth") ---
  const SESSION_KEY = 'fni_session';
  const USER_KEY = 'fni_user';

  function saveSession(email, remember) {
    const user = {
      name: email.split('@')[0].replace(/\W+/g, ' ').trim() || 'User',
      email
    };
    // Persist user
    localStorage.setItem(USER_KEY, JSON.stringify(user));
    // Session: use localStorage for "remember", sessionStorage otherwise
    const store = remember ? localStorage : sessionStorage;
    store.setItem(SESSION_KEY, 'true');
    return user;
  }

  function isValidEmail(v) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
  }

  document.addEventListener('DOMContentLoaded', () => {
    M.Sidenav.init(document.querySelectorAll('.sidenav'));
    M.updateTextFields();

    // Password visibility toggle
    const pwd = document.getElementById('login-password');
    const toggle = document.getElementById('togglePwd');
    toggle.addEventListener('click', () => {
      const showing = pwd.getAttribute('type') === 'text';
      pwd.setAttribute('type', showing ? 'password' : 'text');
      toggle.querySelector('i').textContent = showing ? 'visibility' : 'visibility_off';
      pwd.focus();
    });

    // Demo: prefill from previous register if present
    try {
      const lastUser = JSON.parse(localStorage.getItem(USER_KEY) || '{}');
      if (lastUser.email) {
        document.getElementById('login-email').value = lastUser.email;
        M.updateTextFields();
      }
    } catch {}

    // Form submit (frontend-only)
    const form = document.getElementById('loginForm');
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const email = document.getElementById('login-email').value.trim();
      const password = pwd.value.trim();
      const remember = document.getElementById('rememberMe').checked;

      if (!isValidEmail(email)) {
        M.toast({ html: 'Please enter a valid email' });
        return;
      }
      if (password.length < 8) {
        M.toast({ html: 'Password must be at least 8 characters' });
        return;
      }

      // Accept any credentials (demo) and "log in"
      const user = saveSession(email, remember);
      M.toast({ html: `Welcome, ${user.name}!` });

      // Redirect to profile
      setTimeout(() => {
        window.location.href = '/frontend/profile.html';
      }, 500);
    });
  });
</script>
</body>
</html>
